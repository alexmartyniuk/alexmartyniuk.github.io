---
layout: post
published: false
title:  "Транзакції в NoSQL. Погляд на DynamoDB з позиції C#"
date:   2020-09-28 23:00:00 +0200
date_friendly: 28 вересня 2020 р. 
categories: [Програмування, dotNET]
tags: [dotnet, DynamoDB, AWS, NoSQL, transactions, ACID]
---

NoSQL проти SQL

На протязі багатьох років в розробці програм домінували реляційні бази даних. SQL став однією з найпоширеніших мов програмування, а інженери що знали як правильно спроектувати і підтримувати роботу таких БД відокремились в окрему касту, що називається адміністратори БД або DBA. Після років розвитку SQL бази даних стали надійним інструментом при реалізації найрізноманітнішого роду програм, які вимагали узгодженості даних. Це стало можливим завдяки транзакціям, тригерам та об'єднанню даних (join) на рівні БД. Але на початку 20 століття розвиток WEB 2.0 і потреби таких компаній як Google, Facebook і Amazon спричинили революцію в збереженні даних. Сувора узгодженість і можливості внутрішнього об'єднання відступили під вимогами високої доступності, швидкості та горизонтального масштабування. З'явились такі СУБД як Neo4j, Memcached, Redis, MongoDB, Cassandra і Amazon DynamoDB. Вони призначались для збереження не структурованих даних в кластерних системах і сувора узгодженість тут не завжди була потрібна. З часом сформувалась стійка думка, що NoSQL бази даних - це для не впорядкованих даних великих розмірів, що необхідно розподіляти по багатьох серверах і швидко знаходити за примітивними запитами типу первісного ключа. В той час як SQL - це для структурованих даних, які містять відношення і повинні бути суворо узгодженими завдяки механізму транзакцій. Таке розділення способів зберігання даних призвело до породження специфічних підходів до проектування різних програмних систем. Програмісту чи архітектору перед тим як намалювати схему системи і включити в неї ту чи іншу БД необхідно було вирішити чи потрібна підсистемі зберігання даних сувора узгодженість. Що важливіше - ACID чи висока доступність та швидкість роботи з даними? Така ситуація тривала деякий час, аж поки в NoSQL базах даних не почали впроваджувати транзакції. 

В цій статті я розкажу як транзакції реалізовані в одній з перших NoSQL баз даних - Amazon DynamoDB, чим вони відрізняються від транзакцій в SQL, в яких випадках варто будувати програми з їх використанням та покажу як практично працювати з транзакціями в DynamoDB за допомогою C# та .NET Core.

DynamoDB

Для початку познайомимось з деякими концептами цієї бази даних. DynamoDB - документна база даних без схеми. Вона зберігає дані в таблицях, кожна з яких може розміщуватись на декількох серверах. Первісний ключ таблиці, який є обов'язковим, складається з ключа секції (Partition Key) та ключа сортування (Sort Key або Range Key). DynamoDB використовує JSON для представлення документів. Створення таблиці вимагає лише трьох аргументів: імені таблиці, ключа та списку атрибутів записів, серед яких повинні бути атрибут, що використовується як ключ секції. Тоді як реляційні бази даних пропонують надійні мови запитів, DynamoDB пропонує лише операції Put, Get, Update та Delete. Через свою простоту DynamoDB дуже добре масштабується і має практично необмежену пропускну здатність. Ще однією особливістю БД є те, що її використання тарифікується не за місцем, яке займають дані, а за пропускною здатністю. База може масштабуватись автоматично або використовувати наперед заданий ліміт пропускної здатності, що вимірюється так званими RCU та WCU. RCU (read capacity unit) - це одиниця читання, що відповідає одному запиту на читання до 4 Kb даних. WCU (write capacity unit) - аналогічно працює на запис, тільки ліміт даних для одного WCU менший - 1 Kb.

Давайте спробуємо запустити DynamoDB локально і виконати прості запити на читання і запис даних.